# CDN(CloudFront)

CloudFront는 전 세계에 파일을 빠른 속도로 배포하는 CDN 서비스입니다.

CloudFront를 사용해야 하는 이유는 전송 속도 향상과 비용 절감에 있습니다.

전 세계를 대상으로 하는 서비스를 준비할 때, 세계 곳곳에 서버를 구축하는 것은 현실적으로 어렵습니다. 또한, AWS를 사용한다 하더라도 모든 리전에 EC2 인스턴스나 S3 버킷을 생성하는 것은 비효율적이며 비용도 많이 듭니다.

그래서 CloudFront인 캐시 서버를 이용해서 각 사용자들의 가까운 에지 로케이션 파일이나 데이터를 캐시해 속도를 높여줍니다.

![image1](/Img/CDN/CDN1.png)

EC2 인스턴스나 S3 버킷은 동작되는 장소가 리전에 한정적입니다. 그래서 먼 거리의 지역의 경우 전송 속도가 느린데 이를 CloudFront를 이용하여 EC2, ELB,S3 버킷의 내용을 에지 로케이션에 캐시하면 빠른 성능을 낼 수 있습니다.

![image2](/Img/CDN/CDN2.png)

사용자가 맨 처음 CloudFront 에지 로케이션에 접속했을 때, 원하는 파일이 에지 로케이션에 있으면 바로 파일을 받지만 파일이 없으면 에지 로케이션이 원본 파일이 있는 오리진에 접속하여 파일을 가져온뒤 사용자에게 전달합니다.

![image3](/Img/CDN/CDN3.png)

에지 로케이션에 원하는 파일이 있다면 오리진에 접속하지 않고 바로 파일을 전송 받을 수 있습니다. 캐시 파일이 유지되는 시간은 기본적으로 24시간이며 HTTP 헤더의 Cache-Control을 이용하여 시간을 조절할 수 있습니다. 그리고 에지 로케이션에 있는 파일이 즉각 갱신되어야 할 경우 무효화요청을 통해 캐시된 파일을 삭제시킬 수 있습니다.

CloudFront는 일반적인 CDN 서비스와는 다른 특징이 있습니다.

- 동적 콘텐츠 전송(Dynamic Content Delivery)을 지원합니다.
    - URL 규칙에 따라 정적 페이지는 캐시하고, 동적 페이지는 바로 EC2 인스턴스로 접속하도록 구성할 수 있습니다.
    - HTTP GET 메서드 이외에도 HEAD, POST, PUT, DELETE, OPTIONS, PATCH 메서드를 지원합니다. 특히 POST, PUT, DELETE, OPTIONS, PATCH 메서드는 캐시되지 않고 곧바로 오리진으로 전달됩니다.
    - HTTP 쿠키를 지원합니다. CloudFront 에지 로케이션이 중간에서 쿠키를 전달해줍니다.
- 동영상 전송을 위한 라이브 스트리밍 프로토콜을 지원합니다. Microsoft Smooth Streaming, Adobe RTMP Streaming 등의 다양한 프로토콜을 지원합니다.
- 사용한 만큼 가격을 지불합니다.

# CloudFront 배포

CloudFront 배포는 CloudFront의 가장 기본적인 단위입니다. 이 배포가 독립적인 도메인을 가지고 후에 DNS 서비스인 Route 53이나 별도의 DNS 서버에서 배포 도메인을 CNAME으로 설정하면 사용자가 구매한 도메인과 연결할 수 있습니다.

여기서 중요한 개념이 오리진(Origin)입니다. CloudFront는 CDN서비스이기 때문에 항상 오리진 서버가 있어야 합니다. 

CloudFront가 지원하는 오리진은 다음과 같습니다.

- S3 버킷 : 가장 기본적인 오리진 입니다. S3에 버킷을 생성하고 파일을 저장하기만 하면 되기 때문에 가장 간편합니다.
- EC2 인스턴스 : EC2 인스턴스에 웹 서버를 구축하면 오리진으로 사용할 수 있습니다.
- ELB(Elastic Load Balancing) : EC2 인스턴스 여러 대의 부하를 분산하는 ELB도 오리진으로 사용할 수 있습니다.
- AWS 이외의 웹 서버 : 웹 서버의 형태만 띠고 있다면 운영체제, 서버 애플리케이션의 종류에 상관없이 오리진으로 사용할 수 있습니다.